---
title: "Gender Disparities Overview"
subtitle: "Cleaning, Exploration, and Patterns in the 2024 Job Market"
bibliography: references.bib
csl: csl/econometrica.csl
format:
  html:
    toc: true
    code-fold: true
    code-tools: true
---

<div class="card reveal">

### Import Fred APIs

```{python}
import os
from dotenv import load_dotenv
from fredapi import Fred
import plotly.graph_objects as go
import plotly.io as pio
import pandas as pd
import os

os.makedirs("figures", exist_ok=True)

# Load API key from .env
load_dotenv()
fred = Fred(api_key=os.getenv("FRED_API_KEY"))

# List of series IDs and rename the variables (using data for women/men over 16)
series_map = {
    "unemp_total": "UNRATE", # Unemployment rate
    # Participation rate
    "part_women": "LNS11300002",
    "part_men": "LNS11300001",
    # Unemployment rate 
    "unemp_women": "LNS14000002",
    "unemp_men": "LNS14000001",
    # Median weekly earnings/full-time salaries
    "earn_women": "LEU0252882800A",
    "earn_men": "LEU0252881900A",
    # Total non-farm employees (seasonally adjusted, no data avalaible for men)
    "emp_nonfarm_total" : "PAYEMS",
    "emp_nonfarm_women" : "CES0000000010",
    "emp_nonfarm_women_ratio" : "CES0000000039", # women-to-all-employees ratio
    
    # STEM-leaning sectors (by industry): manufacturing; information (tech/media/communications); professional, scientific & technical services; mining & logging; utilities monthly, thousands of persons)
    # Manufacturing
    "emp_manu_women" : "CES3000000010", #SA
    #"emp_manu_men" : "CES3000000011",
    "emp_manu_women_ratio" : "CES3000000039", #SA, women-to-all-emp ratio
    # Information/Tech sector
    "emp_info_women" : "CES5000000010", #SA
    #"emp_info_men" : "CES5000000011",
    "emp_info_women_ratio" : "CES5000000039", #SA, women-to-all-emp ratio
    # Professional, scientific & technical services
    "emp_buser_women" : "CES6000000010", #SA
    #"emp_buser_men" : "CES6000000011",
    "emp_buser_women_ratio" : "CES6000000039", #SA, women-to-all-emp ratio
    # Construction
    "emp_construct_women" : "CES2000000010", # SA
    #"emp_construct_men" : "CES2000000011",
    "emp_construct_women_ratio" : "CES2000000039", #SA, women-to-all-emp ratio
    # Mining & Logging
    "emp_mining_women" : "CES1000000010", #SA
    #"emp_mining_men" : "CES1000000011",
    "emp_mining_women_ratio" : "CES1000000039", #SA, women-to-all-emp ratio
    # Utilities
    "emp_utl_women" : "CES4422000010", #SA
    #"emp_utl_men" : "CES4422000011",
    "emp_utl_women_ratio" : "CES4422000039", #SA, women-to-all-emp ratio
        
    # Non-STEM sectors: retail trade; leisure & hospitality; education & health services; financial activities; other services; government; trade, transportation & utilities (monthly, thousands of persons)
    # Retail Trade
    "emp_retail_women": "CES4200000010", #SA
    #"emp_retail_men": "CES4200000011",
    "emp_retail_women_ratio": "CES4200000039", #SA, women-to-all-emp ratio
    # Leisure & Hospitality
    "emp_leisure_women": "CES7000000010", #SA
    #"emp_leisure_men": "CES7000000011",
    "emp_leisure_women_ratio": "CES7000000039", #SA, women-to-all-emp ratio
    # Education & Health Services
    "emp_edhealth_women": "CES6500000010", #SA
    #"emp_edhealth_men": "CES6500000011",
    "emp_edhealth_women_ratio": "CES6500000039", #SA, women-to-all-emp ratio
    # Financial Activities
    "emp_finact_women": "CES5500000010",
    #"emp_finact_men": "CES5500000011",
    "emp_finact_women_ratio": "CES5500000039", #SA, women-to-all-emp ratio
    # Other Services (Excluding Gov)
    "emp_other_women": "CES8000000010",
    #"emp_other_men": "CES8000000011",
    "emp_other_women_ratio": "CES8000000039", #SA, women-to-all-emp ratio
    # Government
    "emp_gov_women": "CES9000000010",
    "emp_gov_women_ratio": "CES9000000039" #SA, women-to-all-emp ratio
}

# Download data
data = {label: fred.get_series(sid) for label, sid in series_map.items()}
#print(data["part_women"].head())
```

</div>

<div class="card reveal">

### Chart 1: Unemployment Rate (Men vs Women)

```{python}
fig_unemp = go.Figure()
# Men unemployment rate
fig_unemp.add_trace(
    go.Scatter(
        x=data["unemp_men"].index,
        y=data["unemp_men"],
        mode="lines",
        name="Men"
    )
)
# Women unemployment rate
fig_unemp.add_trace(
    go.Scatter(
        x=data["unemp_women"].index,
        y=data["unemp_women"],
        mode="lines",
        name="Women"
    )
)
fig_unemp.update_layout(
    title="Unemployment Rate: Men vs Women",
    xaxis_title="Date",
    yaxis_title="Rate (%)",
    legend_title="Group",
    width=700,
    height=500,
    annotations=[
        dict(
            text="Source: U.S. Bureau of Labor Statistics via FRED",
            xref="paper", yref="paper",
            x=1, y=-0.2,
            showarrow=False,
            font=dict(size=10, color="gray"),
            xanchor="right"
        )
    ]
)
fig_unemp.show()
fig_unemp.write_html("figures/unemp_rate.html")
```

</div>

<div class="card reveal">

### Chart 2: Gender Wage Gap Over Time (Median Weekly Earnings)

```{python}
fig_wage = go.Figure()
# Men earnings line
fig_wage.add_trace(
    go.Scatter(
        x=data["earn_men"].index,
        y=data["earn_men"],
        mode="lines",
        name="Men"
    )
)
# Women earnings line
fig_wage.add_trace(
    go.Scatter(
        x=data["earn_women"].index,
        y=data["earn_women"],
        mode="lines",
        name="Women"
    )
)
fig_wage.update_layout(
    title="Median Weekly Earnings: Men vs Women",
    xaxis_title="Year",
    yaxis_title="USD",
    legend_title="Group",
    width=700,
    height=500
)
fig_wage.show()
fig_wage.write_html("figures/gender_wage_gap.html")
```

</div>

<div class="card reveal">

### Chart 3: Labor Force Participation - Men vs Women (Monthly, SA)

```{python}
fig_part = go.Figure()
# Men participation line
fig_part.add_trace(
    go.Scatter(
        x=data["part_men"].index,
        y=data["part_men"],
        mode="lines",
        name="Men"
    )
)
# Women participation line
fig_part.add_trace(
    go.Scatter(
        x=data["part_women"].index,
        y=data["part_women"],
        mode="lines",
        name="Women"
    )
)
fig_part.update_layout(
    title="Labor Force Participation: Men vs Women (Monthly, SA)",
    xaxis_title="Year",
    yaxis_title="Percent (%)",
    legend_title="Group",
    width=700,
    height=500
)
fig_part.show()
fig_part.write_html("figures/labor_force_participation.html")
```

</div>

<div class="card reveal">

### Chart 4: STEM SECTORS – Women Ratio Bar Chart

```{python}
# Get the latest information available from Fred
def get_latest(series):
    s = series.dropna()
    return s.index[-1], s.iloc[-1]  # (date, value)

stem_ratio_vars = {
    "Manufacturing": data["emp_manu_women_ratio"],
    "Information (Tech)": data["emp_info_women_ratio"],
    "Prof/Scientific/Tech": data["emp_buser_women_ratio"],
    "Construction": data["emp_construct_women_ratio"],
    "Mining & Logging": data["emp_mining_women_ratio"],
    "Utilities": data["emp_utl_women_ratio"]
}

# Latest values + dates for each sector then sort the sectors
stem_latest_data = {sector: get_latest(series) for sector, series in stem_ratio_vars.items()}
stem_sorted = pd.Series({k: v[1] for k, v in stem_latest_data.items()}).sort_values(ascending=False)
# Get most recent date across all STEM series
stem_latest_date = max(v[0] for v in stem_latest_data.values()).strftime("%Y-%m")

fig_stem = go.Figure()
fig_stem.add_trace(
    go.Bar(
        x=stem_sorted.index,
        y=stem_sorted.values,
        text=[f"{v:.1f}%" for v in stem_sorted.values],
        textposition="outside"
    )
)
fig_stem.update_layout(
    title=f"Share of Women in STEM Sectors ({stem_latest_date})",
    yaxis_title="Women as % of Total Employment",
    xaxis_title="STEM Sector",
    xaxis_tickangle=30,
    width=700,
    height=500
)
fig_stem.show()
fig_stem.write_html("figures/stem_women_share.html")
```

</div>

<div class="card reveal">

### Chart 5: NON-STEM SECTORS – Women Ratio Bar Chart

```{python}
nonstem_ratio_vars = {
    "Leisure & Hospitality": data["emp_leisure_women_ratio"],
    "Education & Health": data["emp_edhealth_women_ratio"],
    "Financial Activities": data["emp_finact_women_ratio"],
    "Other Services": data["emp_other_women_ratio"],
    "Government": data["emp_gov_women_ratio"],
    "Retail Trade": data["emp_retail_women_ratio"]
}

# Latest value for each sector then sort the sectors
nonstem_latest_data = {sector: get_latest(series) for sector, series in nonstem_ratio_vars.items()}
nonstem_sorted = pd.Series({k: v[1] for k, v in nonstem_latest_data.items()}).sort_values(ascending=False)
# Get the most recent update date
nonstem_latest_date = max(v[0] for v in nonstem_latest_data.values()).strftime("%Y-%m")
fig_nonstem = go.Figure()
fig_nonstem.add_trace(
    go.Bar(
        x=nonstem_sorted.index,
        y=nonstem_sorted.values,
        text=[f"{v:.1f}%" for v in nonstem_sorted.values],
        textposition="outside",
        marker_color="indianred"
    )
)
fig_nonstem.update_layout(
    title=f"Share of Women in Non-STEM Sectors ({nonstem_latest_date})",
    yaxis_title="Women as % of Total Employment",
    xaxis_title="Non-STEM Sector",
    xaxis_tickangle=30,
    width=700,
    height=500
)
fig_nonstem.show()
fig_nonstem.write_html("figures/nonstem_women_share.html")
```

</div>

<div class="card reveal">


# Gender Dominace by Red vs. Blue States

### Prepare the Dataset
```{python}
# Load the dataset for state population by gender (2021-2024) 
df_state = pd.read_csv("data/acs_computer_math_gender_by_state_5yrs.csv")

# Compute gender shares between states 
df_state["female_pct"] = (df_state["cm_female"] / df_state["cm_total"] * 100).round(2) 
df_state["male_pct"] = (df_state["cm_male"] / df_state["cm_total"] * 100).round(2) 

df_state.head()
```

### Create an Alignment Map for Red vs. Blue State across US
```{python} 
state_align_map = { 
    # Blue states 
    "California": "Blue", "Colorado": "Blue", "Connecticut": "Blue", "Delaware": "Blue", "District of Columbia": "Blue", "Hawaii": "Blue", "Illinois": "Blue", "Maine": "Blue", "Maryland": "Blue", "Massachusetts": "Blue", "Minnesota": "Blue", "Nevada": "Blue", "New Hampshire": "Blue", "New Jersey": "Blue", "New Mexico": "Blue", "New York": "Blue", "Oregon": "Blue", "Rhode Island": "Blue", "Vermont": "Blue", "Virginia": "Blue", "Washington": "Blue", "Georgia": "Blue", "Arizona": "Blue", "Pennsylvania": "Blue", "Michigan": "Blue", "Wisconsin": "Blue", 

    # Red states (Republican-leaning in 2020)
    "Alabama": "Red", "Alaska": "Red", "Arkansas": "Red", "Florida": "Red", "Idaho": "Red", "Indiana": "Red", "Iowa": "Red", "Kansas": "Red", "Kentucky": "Red", "Louisiana": "Red", "Mississippi": "Red", "Missouri": "Red", "Montana": "Red", "Nebraska": "Red", "North Carolina": "Red", "North Dakota": "Red", "Ohio": "Red", "Oklahoma": "Red", "South Carolina": "Red", "South Dakota": "Red", "Tennessee": "Red", "Texas": "Red", "Utah": "Red", "West Virginia": "Red", "Wyoming": "Red", 

    # Territories 
    "Puerto Rico": "Territory" } 

df_state["alignment"] = df_state["state_name"].map(state_align_map) 

df_state.head() 

# Drop Puerto Rico and any non-aligned rows
df_state = df_state[df_state["alignment"].isin(["Red","Blue"])].copy() 

# Aggregate by alignment + year 
state_agg = (df_state.groupby(["year","alignment"])[["female_pct","male_pct"]].mean().reset_index().round(2))

display(state_agg) 
```

</div>

<div class="card reveal">

### Chart 1: Women Share in Blue vs Red States (2021–2024)

```{python}
color_map = {
    "Blue": "rgba(0, 102, 204, 0.8)",
    "Red": "rgba(204, 0, 0, 0.8)"
}

fig_female = px.bar(
    state_agg,
    x="year",
    y="female_pct",
    color="alignment",
    barmode="group",
    text="female_pct",
    labels={"female_pct": "Women Share (%)"},
    title="Women Share in Blue vs Red States (2021–2024)",
    color_discrete_map=color_map
)

fig_female.update_traces(texttemplate="%{text:.2f}", textposition="outside")

fig_female.update_layout(
    xaxis_title="Year",
    yaxis_title="Women Share (%)",
    legend_title="State Alignment",
    width=800,
    height=500
)
fig_female.show()
fig_female.write_html("figures/female_share_state.html")
```

</div>

<div class="card reveal">

### Chart 2: Women vs. Men Share in Red State (2021-2024)

```{python}
stacked_data = state_agg.melt(
    id_vars=["year","alignment"],
    value_vars=["female_pct","male_pct"],
    var_name="gender",
    value_name="percentage"
)

colors = {
    "male_pct": "rgba(137, 176, 255, 0.8)",
    "female_pct": "rgba(255, 179, 207, 0.8)"
}

# Red States Stacked Bar Chart
df_red = stacked_data[stacked_data["alignment"] == "Red"]

fig_red = px.bar(
    df_red,
    x="year",
    y="percentage",
    color="gender",
    barmode="stack",
    text="percentage",
    labels={"percentage": "Share (%)"},
    title="Women vs. Men in Red States (2021–2024)",
    color_discrete_map=colors
)

fig_red.update_traces(texttemplate="%{text:.2f}", textposition="inside")
fig_red.update_layout(
    xaxis_title="Year",
    yaxis_title="Share (%)",
    legend_title="Gender",
    width=700,
    height=500
)
fig_red.show()
fig_red.write_html("figures/gender_state_red.html")
```

</div>

<div class="card reveal">

### Chart 3: Women vs. Men Share in Blue State (2021-2024)

```{python}
# Blue States Stacked Bar Chart
df_blue = stacked_data[stacked_data["alignment"] == "Blue"]

fig_blue = px.bar(
    df_blue,
    x="year",
    y="percentage",
    color="gender",
    barmode="stack",
    text="percentage",
    labels={"percentage": "Share (%)"},
    title="Women vs. Men in Blue States (2021–2024)",
    color_discrete_map=colors
)

fig_blue.update_traces(texttemplate="%{text:.2f}", textposition="inside")
fig_blue.update_layout(
    xaxis_title="Year",
    yaxis_title="Share (%)",
    legend_title="Gender",
    width=700,
    height=500
)
fig_blue.show()
fig_blue.write_html("figures/gender_state_blue.html")
```

</div>

<div class="card reveal">

### Chart 4: US Female Share by State (2024)

```{python}
# Choose the year to show
year_choice = 2024

df_year = df_state[df_state["year"] == year_choice].copy()
df_year["state_code"] = df_year["state_name"].map(state_to_abbrev)
df_year = df_year[df_year["state_code"].notna()].copy()

df_year["align_val"] = df_year["alignment"].map({"Red": 0, "Blue": 1})
df_year["lat"] = df_year["state_code"].map(lambda x: state_centroids[x][0])
df_year["lon"] = df_year["state_code"].map(lambda x: state_centroids[x][1])

color_map = {
    "Blue": "rgba(0, 102, 204, 0.8)",
    "Red": "rgba(204, 0, 0, 0.8)"
}

fig = go.Figure()

# Base layer
fig.add_trace(go.Choropleth(
    locations=df_year["state_code"],
    z=df_year["align_val"],
    locationmode="USA-states",
    colorscale=[[0, color_map["Red"]], [1, color_map["Blue"]]],
    showscale=False,
    marker_line_color="white",
    marker_line_width=0.5
))

# Bubble overlay: only state name visible, female_pct in hover
fig.add_trace(go.Scattergeo(
    lon=df_year["lon"],
    lat=df_year["lat"],
    text=df_year["state_code"],
    hovertext=df_year.apply(lambda r: f"{r['state_name']}<br>Female: {r['female_pct']:.1f}%", axis=1),
    marker=dict(
        size=df_year["female_pct"] * 1.5,
        color="white",
        opacity=0.85,
        line=dict(width=0.5, color="black")
    ),
    mode="markers+text",
    textposition="middle center",
    hoverinfo="text",
    name="Female Share"
))

fig.update_layout(
    title=f"US Female Employment Share by State ({year_choice})",
    title_x=0.5,
    margin=dict(t=80),
    geo=dict(
        scope="usa",
        projection=go.layout.geo.Projection(type="albers usa"),
        showland=True,
        landcolor="rgb(240,240,240)"
    ),
    width=800,
    height=600,
    legend_title_text="Female Share"
)

fig.show()
fig.write_html(f"figures/us_female_state_map.html")
```

</div>

