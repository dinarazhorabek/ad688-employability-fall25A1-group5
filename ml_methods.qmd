---
title: "ML Methods"
subtitle: "Linking Job Postings with Macroeconomic Indicators"
bibliography: references.bib
csl: csl/econometrica.csl
format:
  html:
    toc: true
    code-fold: true
    code-tools: true
---

<div class="card reveal">

## Data Sources

Some comments ...

```{python}
import pandas as pd
import numpy as np

# Gender dominance categories
naics_gender_map = {
    11: "Male-dominated",
    21: "Male-dominated",
    22: "Male-dominated",
    23: "Male-dominated",              # was strongly male
    31: "Male-dominated",
    42: "Male-dominated",
    44: "Mixed",
    48: "Male-dominated",
    51: "Mixed",
    52: "Female-dominated",
    53: "Female-dominated",
    54: "Female-dominated",
    55: "Mixed",
    56: "Mixed",
    61: "Female-dominated",            # was strongly female
    62: "Female-dominated",            # was strongly female
    71: "Mixed",
    72: "Female-dominated",
    81: "Female-dominated",
    92: "Mixed",
    99: "Mixed",
}

# Numeric encoding (ordered for ML)
gender_encoding = {
    "Male-dominated": 0,
    "Mixed": 1,
    "Female-dominated": 2,
}
```

```{python}
lightcast_jp = pd.read_csv("data/lightcast_cleaned.csv",low_memory=False)
```

```{python}
lightcast_jp["GENDER_DOMINANCE"] = lightcast_jp["NAICS_2022_2"].map(naics_gender_map).map(gender_encoding)
```


```{python}
features = ["SALARY", "GENDER_DOMINANCE", "MIN_YEARS_EXPERIENCE", "EMPLOYMENT_TYPE", "REMOTE_TYPE", "IS_INTERNSHIP", "COMPANY_IS_STAFFING", "STATE_NAME", "NAICS_2022_2"]

lightcast_jp[features].isna().sum()

median_salary = lightcast_jp["SALARY"].median()
lightcast_jp = lightcast_jp.fillna({
  "SALARY": median_salary
})

df_model = lightcast_jp[features]
# df_model.isna().sum()

df_model = pd.get_dummies(
    df_model,
    columns=["IS_INTERNSHIP", "COMPANY_IS_STAFFING", "STATE_NAME"],
    drop_first=True
)
```


```{python}
from sklearn.model_selection import train_test_split
from sklearn.linear_model import LinearRegression

X = df_model.drop("SALARY", axis=1)
y = df_model["SALARY"]

X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.6, random_state=79)

model = LinearRegression()
model.fit(X_train, y_train)

coef = model.coef_[ list(X.columns).index("GENDER_DOMINANCE") ]
print("Salary change per category step:", coef)
```


```{python}
base = X_train.mean().copy()

pred = {}
for group_code in [0, 1, 2]:
    base["GENDER_DOMINANCE"] = group_code
    pred[group_code] = model.predict([base])[0]

pred
```